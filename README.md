# compound-annotator

Credits: [Lewis Mervin](https://github.com/lewismervin1) for the orignal source code.

## Setup

1. [Install Python](https://www.python.org/downloads/)
1. [Install Poetry](https://python-poetry.org/docs/#installation)
1. [Install Poetry Environment](https://python-poetry.org/docs/basic-usage/#installing-dependencies): `poetry install`

For Linux, see

- <https://github.com/python-poetry/poetry/issues/1917#issuecomment-1380429197> if installing six fails
- <https://stackoverflow.com/a/75435100> if you get "does not contain any element" warning when running `poetry install`

## Run

### Create annotation file

The file `data/chembl_annotation.csv.gz` is a compressed version of the file `data/chembl_annotation.csv` which is generated by the following steps:

On a VM with >40G disk space, download ChEMBL SQLite database (4.2G compressed, 23G uncompressed)

```sh
wget https://ftp.ebi.ac.uk/pub/databases/chembl/ChEMBLdb/latest/chembl_31_sqlite.tar.gz
tar -xvzf chembl_31_sqlite.tar.gz
```

This produces a directory `chembl_31_sqlite` with the following structure:

```sh
chembl_31
└── chembl_31_sqlite
    ├── INSTALL_sqlite
    └── chembl_31.db
```

Run SQL query to extract ChEMBL annotation

```sh
sqlite3 -header -csv chembl_31/chembl_31_sqlite/chembl_31.db < sql/extract_chembl_annotation.sql > data/chembl_annotation.csv
```

View the top 5 rows of the annotation file

```sh
head -n 5 data/chembl_annotation.csv
```

```text
assay_chembl_id,target_chembl_id,assay_type,molecule_chembl_id,pchembl_value,confidence_score,standard_inchi_key,pref_name
1714633,CHEMBL3987582,B,CHEMBL4107559,6.07,7,UVVXRMZCPKQLAO-OAHLLOKOSA-N,
1714649,CHEMBL3987582,B,CHEMBL4107559,5.86,7,UVVXRMZCPKQLAO-OAHLLOKOSA-N,
1714633,CHEMBL3987582,B,CHEMBL4108338,6.15,7,OZBMIGDQBBMIRA-CQSZACIVSA-N,
1714649,CHEMBL3987582,B,CHEMBL4108338,5.84,7,OZBMIGDQBBMIRA-CQSZACIVSA-N,
```

Rendered as a table:

| assay_chembl_id | target_chembl_id | assay_type | molecule_chembl_id | pchembl_value | confidence_score | standard_inchi_key          | pref_name |
|-----------------|------------------|------------|--------------------|---------------|------------------|-----------------------------|-----------|
| 1714633         | CHEMBL3987582    | B          | CHEMBL4107559      | 6.07          | 7                | UVVXRMZCPKQLAO-OAHLLOKOSA-N |           |
| 1714649         | CHEMBL3987582    | B          | CHEMBL4107559      | 5.86          | 7                | UVVXRMZCPKQLAO-OAHLLOKOSA-N |           |
| 1714633         | CHEMBL3987582    | B          | CHEMBL4108338      | 6.15          | 7                | OZBMIGDQBBMIRA-CQSZACIVSA-N |           |
| 1714649         | CHEMBL3987582    | B          | CHEMBL4108338      | 5.84          | 7                | OZBMIGDQBBMIRA-CQSZACIVSA-N |           |
